<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إتقان - تقرير جودة التعليم</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        :root { --primary: #1e4078; --text: #000000; --bg: #f7f9fc; --border-color: #000000; }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { margin: 0; background: var(--bg); color: var(--text); }
        
        /* --- UI Layout Styles (Non-Print) --- */
        .app-container { display: flex; min-height: 100vh; }
        .sidebar { width: 260px; background: white; border-left: 1px solid #e0e0e0; position: fixed; right: 0; top: 0; height: 100%; z-index: 100; }
        .sidebar-header { padding: 20px; border-bottom: 1px solid #f0f4f8; display: flex; gap: 10px; align-items: center; }
        .sidebar-header i { font-size: 1.8rem; color: var(--primary); }
        .nav-links { list-style: none; padding: 20px 0; margin: 0; }
        .nav-links li { margin-bottom: 5px; cursor: pointer; }
        .nav-links a { display: flex; align-items: center; padding: 12px 25px; color: #777; text-decoration: none; font-weight: 600; border-right: 4px solid transparent; transition:0.3s;}
        .nav-links a:hover, .nav-links a.active { color: var(--primary); background: #f0f4f8; border-right-color: var(--primary); }
        .nav-links a i { margin-left: 10px; width: 25px; text-align: center; }

        .main-content { margin-right: 260px; flex: 1; padding: 30px; }
        .section-card { background: white; border-radius: 10px; padding: 25px; margin-bottom: 20px; display: none; box-shadow: 0 4px 10px rgba(0,0,0,0.03); }
        .section-card.active { display: block; }
        
        /* Buttons & Forms */
        .btn { padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-primary { background: var(--primary); color: white; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px; }
        
        /* --- A4 REPORT STYLES (Print & Preview) --- */
        .report-preview-container {
            background: #525659;
            padding: 40px;
            overflow: auto;
            max-height: 800px;
            display: flex;
            justify-content: center;
        }
        
        .a4-page {
            background: white;
            width: 210mm;
            min-height: 297mm;
            padding: 20mm; /* Standard Word Margins */
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            position: relative;
            color: black;
            font-size: 14px; /* Matches Word Body Text */
            line-height: 1.4;
        }

        /* Report Header Section */
        .rpt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
        }
        .rpt-header-side { width: 30%; text-align: center; font-size: 12px; font-weight: bold; }
        .rpt-header-center { width: 30%; text-align: center; }
        .rpt-logo { height: 75px; object-fit: contain; } /* Bahrain Emblem Size */
        .rpt-logo-min { height: 60px; object-fit: contain; } 

        /* Report Titles */
        .rpt-title-box {
            border: 1px solid #000;
            background-color: #f2f2f2; /* Light Gray Shading */
            padding: 8px;
            text-align: center;
            margin: 15px auto;
            width: 90%;
            font-weight: bold;
            font-size: 16px;
        }
        
        .rpt-school-info {
            text-align: center;
            font-weight: bold;
            margin-bottom: 25px;
            font-size: 14px;
        }

        .rpt-section-title {
            font-weight: bold;
            text-decoration: underline;
            margin-top: 25px;
            margin-bottom: 10px;
            font-size: 15px;
        }

        /* Report Tables */
        .rpt-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            font-size: 12px;
            page-break-inside: auto;
        }
        .rpt-table th, .rpt-table td {
            border: 1px solid #000; /* Solid Black Borders */
            padding: 6px;
            text-align: center;
            vertical-align: middle;
        }
        .rpt-table th {
            background-color: #d9d9d9; /* Standard Word Table Header Gray */
            font-weight: bold;
        }
        .rpt-table .align-right { text-align: right; }
        .rpt-table tr { page-break-inside: avoid; }

        /* Report Signatures */
        .rpt-signature-row {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
            margin-bottom: 30px;
            page-break-inside: avoid;
        }
        .rpt-sig-box { text-align: center; width: 40%; }
        .rpt-sig-title { font-weight: bold; margin-bottom: 40px; }
        .rpt-sig-name { font-weight: bold; font-family: 'Tajawal', sans-serif; }

        /* Performance Chart Image in Report */
        .rpt-chart-img {
            display: block;
            margin: 20px auto;
            max-width: 80%;
            max-height: 300px;
            border: 1px solid #ccc;
        }

        /* Print Media Query */
        @media print {
            body * { visibility: hidden; }
            .a4-page, .a4-page * { visibility: visible; }
            .a4-page {
                position: absolute;
                left: 0; top: 0;
                width: 100%;
                margin: 0;
                padding: 15mm; /* Print Margins */
                box-shadow: none;
                border: none;
            }
            .sidebar, .top-header, .filter-container, .btn, .custom-tabs { display: none !important; }
            @page { size: A4; margin: 0; }
        }
    </style>
</head>
<body>

    <div id="loginPage" style="position:fixed; width:100%; height:100%; background:#1e4078; display:flex; justify-content:center; align-items:center; z-index:999;">
        <div style="background:white; padding:40px; border-radius:10px; text-align:center; width:350px;">
            <i class="fas fa-graduation-cap" style="font-size:3rem; color:#1e4078; margin-bottom:15px;"></i>
            <h2 style="margin:0 0 20px 0;">نظام إتقان</h2>
            <button class="btn btn-primary" style="width:100%;" onclick="startApp()">تسجيل الدخول</button>
        </div>
    </div>

    <div id="app" class="app-container" style="display:none;">
        <aside class="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-graduation-cap"></i>
                <div><b>إتقان</b><br><small>مدرسة مدينة حمد</small></div>
            </div>
            <ul class="nav-links">
                <li><a onclick="showSection('dashboard')" class="active"><i class="fas fa-home"></i> لوحة التحكم</a></li>
                <li><a onclick="showSection('visits')"><i class="fas fa-clipboard-check"></i> الزيارات الصفية</a></li>
                <li><a onclick="showSection('report')"><i class="fas fa-file-word"></i> تقرير الجودة (Word)</a></li>
            </ul>
        </aside>

        <main class="main-content">
            <header style="display:flex; justify-content:space-between; margin-bottom:30px;">
                <h2>لوحة التحكم</h2>
                <div style="display:flex; align-items:center; gap:10px;">
                    <span>مرحباً، <b>مديرة المدرسة</b></span>
                    <button class="btn" style="background:#eee;" onclick="location.reload()"><i class="fas fa-sign-out-alt"></i></button>
                </div>
            </header>

            <div id="dashboard" class="section-card active">
                <h3>ملخص البيانات</h3>
                <p>مرحباً بك في نظام تتبع جودة التعليم. انتقل إلى "تقرير الجودة" لإصدار التقرير المطابق للقالب.</p>
                <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:20px; margin-top:20px;">
                    <div style="background:#eef4ff; padding:20px; border-radius:8px; border-right:4px solid var(--primary);">
                        <h2>70</h2>
                        <p>مجموع الزيارات</p>
                    </div>
                     <div style="background:#e8f7ec; padding:20px; border-radius:8px; border-right:4px solid #28a745;">
                        <h2>7</h2>
                        <p>معلمين متميزين</p>
                    </div>
                </div>
            </div>

            <div id="visits" class="section-card">
                <h3>سجل الزيارات الصفية</h3>
                <p>هنا يتم تسجيل الزيارات (بيانات محاكاة للمثال).</p>
            </div>

            <div id="report" class="section-card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; background:#f8f9fa; padding:15px; border-radius:8px;">
                    <div style="display:flex; gap:10px; align-items:center;">
                        <label>اختر شهر التقرير:</label>
                        <select id="reportMonth" class="form-control" style="width:auto; margin:0;">
                            <option value="09">سبتمبر</option>
                            <option value="10">أكتوبر</option>
                        </select>
                        <button class="btn btn-primary" onclick="generateReport()">إصدار التقرير</button>
                    </div>
                    <div>
                        <button class="btn" style="background:#28a745; color:white;" onclick="window.print()"><i class="fas fa-print"></i> طباعة / حفظ PDF</button>
                    </div>
                </div>

                <div class="report-preview-container">
                    <div id="a4-content" class="a4-page">
                        <div style="text-align:center; padding-top:100px; color:#999;">
                            <i class="fas fa-file-alt" style="font-size:4rem;"></i><br><br>
                            يرجى الضغط على "إصدار التقرير" لعرض البيانات
                        </div>
                    </div>
                </div>
            </div>

            <canvas id="hiddenChart" width="400" height="200" style="display:none;"></canvas>

        </main>
    </div>

    <script>
        // --- DATA SIMULATION (Matches "September Report" Source) ---
        const DB = {
            settings: {
                schoolName: 'لمدرسة مدينة حمد الابتدائية للبنات',
                year: '2025 / 2026م',
                principal: 'أ. علياء محمد مبارك الدوسري',
                assistant: 'أ. ليلى سعيد حسن'
            },
            visits: [
                // Senior Leadership Visits (Sample)
                {t: 'خديجة رضي النشمي', dept: 'التربية الرياضية', date: '2025-09-23', eval: 'يتجاوز التوقعات بكثير', visitor: 'أ. علياء محمد مبارك الدوسري', role: 'مدير المدرسة'},
                {t: 'منى حبيب الفردان', dept: 'التربية الفنية', date: '2025-09-23', eval: 'يتجاوز التوقعات بكثير', visitor: 'أ. علياء محمد مبارك الدوسري', role: 'مدير المدرسة'},
                {t: 'نوال علي البلوشي', dept: 'التربية الإسلامية', date: '2025-09-25', eval: 'يفي بالتوقعات تماما', visitor: 'أ. علياء محمد مبارك الدوسري', role: 'مدير المدرسة'},
                {t: 'فاطمة أحمد أيوب', dept: 'الرياضيات', date: '2025-09-25', eval: 'يتجاوز التوقعات بكثير', visitor: 'أ. علياء محمد مبارك الدوسري', role: 'مدير المدرسة'},
                 // Middle Leadership Visits (Sample - Adding more to match counts)
                {t: 'فاطمة سمير القوتي', dept: 'نظام فصل', date: '2025-09-15', eval: 'يتجاوز التوقعات', visitor: 'أ. هيا عبدالله عجلان', role: 'منسق نظام الفصل'},
                {t: 'ختام عزاوي العلي', dept: 'نظام فصل', date: '2025-09-23', eval: 'يتجاوز التوقعات بكثير', visitor: 'أ. هيا عبدالله عجلان', role: 'منسق نظام الفصل'},
                {t: 'إيمان محسن عليان', dept: 'اجتماعيات', date: '2025-09-23', eval: 'يتجاوز التوقعات', visitor: 'أ. مريم يعقوب يوسف', role: 'المدير المساعد'},
                {t: 'ليلى محمد علي', dept: 'اجتماعيات', date: '2025-09-23', eval: 'يفي بالتوقعات جزئيا', visitor: 'أ. مريم يعقوب يوسف', role: 'المدير المساعد'}
            ],
            distinguished: [
                {name: 'نور محمد العصفور', dept: 'الرياضيات والعلوم', eval: 'يتجاوز التوقعات بكثير', reason: 'توظيف مهارات القرن 21 في الحصص بصورة مستمرة، وربط المادة العلمية بالواقع.'},
                {name: 'هند جاسم المطاوعة', dept: 'الرياضيات والعلوم', eval: 'يتجاوز التوقعات بكثير', reason: 'توظيف أساليب تعليم وتعلم متنوعة تتماشى مع الفروق الفردية، وتوظيف التكنولوجيا.'},
                {name: 'أ. مريم ناجي محمد', dept: 'نظام الفصل', eval: 'يتجاوز التوقعات بكثير', reason: 'إدارة الموقف التعليمي بفاعلية كبيرة مع إبراز أدوار الطالبات بمختلف الاستراتيجيات.'}
            ],
            care: [
                {name: 'ليلى محمد علي', dept: 'المواد الاجتماعية', eval: 'يفي جزئيا', reason: 'معلمة منقولة حديثاً. تحتاج تطوير في: اتساق التخطيط، توظيف الاستراتيجيات، والتقويم.'},
                {name: 'حصة فؤاد البورشيد', dept: 'نظام الفصل', eval: 'يفي جزئيا', reason: 'معلمة مستجدة. تحتاج تطوير في: إدارة السلوك، توظيف الاستراتيجيات، وأساليب التقويم.'}
            ],
            qualitative: [
                {dept: 'الرياضيات والعلوم', strength: 'تعزيز مهارات القرن 21. تفعيل الأدوار القيادية.', improve: 'الاستثمار الأمثل لوقت التعلم. توظيف أساليب تقويم فاعلة.'},
                {dept: 'اللغة العربية', strength: 'تحقيق الأهداف بشكل جيد. توظيف التمايز بصورة فاعلة.', improve: 'التنويع في الأدوار القيادية. توظيف أدوات التمكين الرقمي.'}
            ],
            middleTracking: [
                {dept: 'معلم أول لغة عربية', visits: 7, minutes: 'يوجد', plan: 'يوجد'},
                {dept: 'منسق رياضيات وعلوم', visits: 9, minutes: 'يوجد', plan: 'يوجد'},
                {dept: 'معلم أول لغة إنجليزية', visits: 8, minutes: 'يوجد', plan: 'يوجد'},
                {dept: 'معلم أول تربية إسلامية', visits: 10, minutes: 'يوجد', plan: 'يوجد'},
                {dept: 'منسق نظام فصل', visits: 8, minutes: 'يوجد', plan: 'يوجد'}
            ]
        };

        // --- APP LOGIC ---
        function startApp() { document.getElementById('loginPage').style.display = 'none'; document.getElementById('app').style.display = 'flex'; }
        
        function showSection(id) {
            document.querySelectorAll('.section-card').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        async function generateReport() {
            const monthVal = document.getElementById('reportMonth').value;
            const monthName = monthVal === '09' ? 'سبتمبر' : 'أكتوبر';
            
            // 1. Generate Chart Image
            const chartData = [34, 23, 9, 4]; // Sample data from source
            const chartImg = await generateChartImage(chartData);

            // 2. Build HTML Structure (Exactly matching the Word Template)
            let html = `
                <div class="rpt-header">
                    <div class="rpt-header-side">
                        <img src="https://upload.wikimedia.org/wikipedia/en/thumb/4/44/Ministry_of_Education_%28Bahrain%29.svg/1200px-Ministry_of_Education_%28Bahrain%29.svg.png" class="rpt-logo-min" alt="Ministry Logo">
                        <div style="margin-top:5px;">Ministry of Education</div>
                    </div>
                    <div class="rpt-header-center">
                         <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/Emblem_of_Bahrain.svg/800px-Emblem_of_Bahrain.svg.png" class="rpt-logo" alt="Bahrain Emblem">
                    </div>
                    <div class="rpt-header-side">
                        <img src="https://upload.wikimedia.org/wikipedia/en/thumb/4/44/Ministry_of_Education_%28Bahrain%29.svg/1200px-Ministry_of_Education_%28Bahrain%29.svg.png" class="rpt-logo-min" alt="Ministry Logo">
                        <div style="margin-top:5px; font-family:'Tajawal'">وزارة التربية والتعليم</div>
                    </div>
                </div>

                <div class="rpt-title-box">
                    تقرير متابعة جودة التعليم والتعلم للقيادة العليا والوسطى
                </div>

                <div class="rpt-school-info">
                    ${DB.settings.schoolName}<br>
                    شهر ${monthName}<br>
                    العام الدراسي ${DB.settings.year}
                </div>

                <div class="rpt-section-title">أولاً: متابعة تسليم القيادة الوسطى (الزيارات/محاضر الاجتماعات/الخطة الأسبوعية):</div>
                <table class="rpt-table">
                    <thead>
                        <tr>
                            <th width="25%">القسم</th>
                            <th width="25%">عدد استمارات الزيارات المنفذة</th>
                            <th width="25%">محضر اجتماع (يوجد/لا)</th>
                            <th width="25%">خطة أسبوعية (يوجد/لا)</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${DB.middleTracking.map(item => `
                        <tr>
                            <td>${item.dept}</td>
                            <td>${item.visits}</td>
                            <td>${item.minutes}</td>
                            <td>${item.plan}</td>
                        </tr>`).join('')}
                    </tbody>
                </table>
                 <p style="font-size:12px; margin-top:5px;">ملاحظات عامة: يتم التنسيق مع القيادة الوسطى لتنفيذ الزيارات الصفية بحسب ما يتناسب مع ظروف الجداول.</p>

                <div class="rpt-section-title">ثانياً: عدد الزيارات التي نُفذت خلال شهر ${monthName}:</div>
                <ul style="list-style:none; padding:0; font-weight:bold;">
                    <li>1- القيادة العليا = 23 زيارة</li>
                    <li>2- القيادة الوسطى = 47 زيارة</li>
                    <li style="margin-top:5px; border-top:1px solid #000; display:inline-block; padding-top:5px;">المجموع الكلي = 70 زيارة</li>
                </ul>

                <div class="rpt-section-title">ثالثاً: بيان أسماء المعلمين المُزارين:</div>
                <table class="rpt-table">
                    <thead>
                        <tr>
                            <th width="5%">ت</th>
                            <th width="20%">اسم المعلم</th>
                            <th width="15%">القسم</th>
                            <th width="15%">تاريخ الزيارة</th>
                            <th width="20%">تقييم الزيارة</th>
                            <th width="25%">اسم الزائر</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${DB.visits.map((v, i) => `
                        <tr>
                            <td>${i + 1}</td>
                            <td>${v.t}</td>
                            <td>${v.dept}</td>
                            <td>${v.date}</td>
                            <td>${v.eval}</td>
                            <td>${v.visitor}<br><span style="font-size:10px; color:#555;">(${v.role})</span></td>
                        </tr>`).join('')}
                    </tbody>
                </table>

                <div class="rpt-section-title">رابعاً: عدد الزيارات الصفية وتقييم الأداء الصفي:</div>
                <table class="rpt-table">
                    <thead>
                        <tr>
                            <th rowspan="2">القسم</th>
                            <th rowspan="2">مجموع الزيارات</th>
                            <th colspan="4">مستويات الأداء</th>
                        </tr>
                        <tr>
                            <th style="font-size:10px;">يتجاوز التوقعات بكثير</th>
                            <th style="font-size:10px;">يتجاوز التوقعات</th>
                            <th style="font-size:10px;">يفي بالتوقعات</th>
                            <th style="font-size:10px;">يفي جزئياً</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>الرياضيات</td><td>11</td><td>7</td><td>3</td><td>1</td><td>-</td></tr>
                        <tr><td>العلوم</td><td>3</td><td>3</td><td>-</td><td>-</td><td>-</td></tr>
                        <tr><td>نظام فصل</td><td>17</td><td>7</td><td>8</td><td>1</td><td>1</td></tr>
                        <tr style="background:#f9f9f9; font-weight:bold;">
                            <td>المجموع الكلي</td>
                            <td>70</td>
                            <td>34</td>
                            <td>23</td>
                            <td>9</td>
                            <td>4</td>
                        </tr>
                    </tbody>
                </table>

                <div style="text-align:center; border:1px solid #000; padding:10px; margin-top:10px;">
                    <img src="${chartImg}" style="max-width:100%; height:200px;">
                    <p style="font-size:12px; margin:5px 0 0 0;">رسم بياني يوضح مستويات الأداء</p>
                </div>

                 <div class="rpt-section-title">سادساً: حصر أسماء المعلمين المتميزين:</div>
                <table class="rpt-table">
                    <thead>
                        <tr>
                            <th width="5%">م</th>
                            <th width="20%">اسم المعلم</th>
                            <th width="15%">القسم</th>
                            <th width="15%">التقدير</th>
                            <th width="45%">المبررات</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${DB.distinguished.map((d, i) => `
                        <tr>
                            <td>${i + 1}</td>
                            <td>${d.name}</td>
                            <td>${d.dept}</td>
                            <td>${d.eval}</td>
                            <td class="align-right">${d.reason}</td>
                        </tr>`).join('')}
                    </tbody>
                </table>

                <div class="rpt-section-title">حصر أسماء المعلمين الأولى بالرعاية:</div>
                <table class="rpt-table">
                    <thead>
                        <tr>
                            <th width="5%">م</th>
                            <th width="20%">اسم المعلم</th>
                            <th width="15%">القسم</th>
                            <th width="15%">التقدير</th>
                            <th width="45%">المبررات (جوانب القصور)</th>
                        </tr>
                    </thead>
                    <tbody>
                         ${DB.care.map((c, i) => `
                        <tr>
                            <td>${i + 1}</td>
                            <td>${c.name}</td>
                            <td>${c.dept}</td>
                            <td>${c.eval}</td>
                            <td class="align-right">${c.reason}</td>
                        </tr>`).join('')}
                    </tbody>
                </table>

                <div class="rpt-section-title">سابعاً: التقرير النوعي (جوانب القوة والتطوير):</div>
                <table class="rpt-table">
                    <thead>
                        <tr>
                            <th width="15%">القسم</th>
                            <th width="42%">جوانب القوة</th>
                            <th width="43%">جوانب بحاجة إلى تطوير</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${DB.qualitative.map(q => `
                        <tr>
                            <td>${q.dept}</td>
                            <td class="align-right">${q.strength}</td>
                            <td class="align-right">${q.improve}</td>
                        </tr>`).join('')}
                    </tbody>
                </table>

                <div class="rpt-signature-row">
                    <div class="rpt-sig-box">
                        <div class="rpt-sig-title">إعداد المديرة المساعدة</div>
                        <div class="rpt-sig-name">${DB.settings.assistant}</div>
                    </div>
                    <div class="rpt-sig-box">
                        <div class="rpt-sig-title">يعتمد، مديرة المدرسة</div>
                        <div class="rpt-sig-name">${DB.settings.principal}</div>
                    </div>
                </div>
            `;

            document.getElementById('a4-content').innerHTML = html;
        }

        // --- Helper to Generate Chart Image ---
        function generateChartImage(data) {
            return new Promise((resolve) => {
                const ctx = document.getElementById('hiddenChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['يفوق التوقعات بكثير', 'يفوق التوقعات', 'يفي بالتوقعات', 'يفي جزئياً'],
                        datasets: [{
                            label: 'عدد المعلمين',
                            data: data,
                            backgroundColor: ['#28a745', '#17a2b8', '#ffc107', '#dc3545'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        animation: {
                            onComplete: function() {
                                resolve(document.getElementById('hiddenChart').toDataURL());
                            }
                        },
                        plugins: { legend: { display: false } },
                        scales: { y: { beginAtZero: true } }
                    }
                });
            });
        }

        // Initialize
        window.onload = function() {
            // Check session or just load login
        };
    </script>
</body>
</html>
